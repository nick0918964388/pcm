# 實作計畫

- [ ] 1. 建立本地檔案儲存系統基礎架構
- [x] 1.1 實作本地檔案系統操作服務
  - ✅ 建立 uploads/photos/ 目錄結構管理功能
  - ✅ 實作專案代碼/相簿名稱的階層式目錄建立
  - ✅ 建立檔案路徑安全驗證和正規化機制
  - ✅ 實作目錄權限檢查和自動修復功能
  - ✅ 建立檔案操作的基礎錯誤處理機制
  - ✅ 完整的 TDD 測試覆蓋 (22 個測試案例)
  - ✅ Vitest 測試環境整合
  - _Requirements: 3.1, 3.2_ ✅

- [ ] 1.2 整合現有檔案安全服務
  - 擴展 FileSecurityService 支援本地檔案路徑驗證
  - 實作檔案上傳配額管理和空間監控
  - 建立檔案衝突檢測和重新命名機制
  - 實作檔案完整性檢查和驗證功能
  - _Requirements: 3.4, 3.6_

- [ ] 2. 建立 Oracle 相簿管理系統
- [ ] 2.1 實作 Oracle 相簿倉儲
  - 擴展現有 OracleBaseRepository 建立 OracleAlbumRepository
  - 整合現有 photo_albums Oracle 表格結構和索引
  - 實作相簿 CRUD 操作，利用 Oracle 觸發器自動維護 photo_count
  - 建立相簿軟刪除機制，使用 deleted_at 欄位保留稽核記錄
  - 實作專案級權限驗證，確保使用者只能存取有權限的專案相簿
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 2.2 實作相簿安全刪除機制
  - 建立刪除前的照片數量檢查，使用 photo_count 欄位快速驗證
  - 實作確認機制，防止意外刪除包含照片的相簿
  - 建立相簿刪除時的本地目錄清理功能
  - 利用 Oracle 外鍵約束自動處理關聯照片的軟刪除
  - 實作刪除操作的稽核日誌記錄
  - _Requirements: 1.6_

- [ ] 3. 實作 Oracle 照片上傳和管理功能
- [ ] 3.1 建立 Oracle 照片倉儲
  - 擴展現有 OracleBaseRepository 建立 OraclePhotoRepository
  - 整合現有 photos 和 photo_versions Oracle 表格結構
  - 實作照片基礎 CRUD 操作，使用 Oracle CLOB 儲存 metadata
  - 建立照片版本管理功能，支援 thumbnail、small、medium、large 版本
  - 實作照片與相簿的關聯管理，利用 Oracle 外鍵約束確保資料一致性
  - _Requirements: 2.1, 2.2, 2.6_

- [ ] 3.2 實作照片管理操作功能
  - 建立照片重新命名和描述編輯功能
  - 實作照片標籤分類系統，使用 Oracle JSON 欄位儲存標籤資料
  - 建立照片刪除功能，同步移除本地檔案和 Oracle 記錄
  - 實作照片 metadata 更新功能，包含 EXIF 資料的 JSON 格式儲存
  - 利用 Oracle 檢視表 active_photos 優化照片查詢效能
  - _Requirements: 2.3, 2.4, 2.5_

- [ ] 4. 實作第四階段：分塊上傳優化系統
- [ ] 4.1 建立分塊上傳核心架構
  - 實作檔案分塊切割功能，使用 1MB 標準分塊大小
  - 建立上傳會話管理系統，在 Oracle 中追蹤分塊上傳進度
  - 實作分塊完整性驗證，使用 SHA-256 checksum
  - 建立分塊重組功能，完成檔案合併作業
  - 實作上傳逾時管理和會話清理機制
  - _Requirements: 2.1, 2.6_

- [ ] 4.2 實作可恢復上傳機制
  - 建立上傳狀態 Oracle 表格，支援斷線後續傳
  - 實作已上傳分塊的查詢和驗證功能
  - 建立智慧重試機制，使用指數退避策略
  - 實作上傳修復功能，檢測和重傳損壞分塊
  - 建立上傳取消和清理功能，同步清理 Oracle 記錄和本地檔案
  - _Requirements: 2.6_

- [ ] 4.3 實作即時上傳進度追蹤
  - 建立分塊上傳進度計算和回報功能
  - 實作即時上傳速度監控和預估完成時間
  - 建立 WebSocket 連線，支援即時進度推送
  - 實作上傳狀態管理，追蹤多檔案並行上傳
  - _Requirements: 4.6_

- [ ] 5. 實作第四階段：批次處理優化系統
- [ ] 5.1 建立 BullMQ 佇列處理架構
  - 整合 Redis 作為佇列後端，建立分散式處理能力
  - 實作批次上傳任務佇列管理功能
  - 建立可配置的 worker 並行控制系統
  - 實作優先級佇列，支援緊急上傳任務
  - 建立任務重試機制和失敗處理策略
  - _Requirements: 2.1, 4.6_

- [ ] 5.2 實作動態資源管理系統
  - 建立記憶體和 CPU 使用率監控功能
  - 實作動態並行度調整，根據系統負載自適應
  - 建立佇列健康監控，追蹤處理速率和等待時間
  - 實作資源警告和降級機制
  - 整合現有 Oracle 監控系統，追蹤資料庫連線池狀態
  - _Requirements: 2.6_

- [ ] 5.3 實作批次處理進度管理
  - 建立批次上傳狀態追蹤和摘要報告功能
  - 實作即時批次進度更新和通知機制
  - 建立批次取消和部分完成處理功能
  - 實作批次錯誤分析和重試建議功能
  - _Requirements: 4.6_

- [ ] 6. 建立現代化前端介面系統
- [ ] 6.1 實作 iPhoto 2.0 主頁面架構
  - 在溝通管理模組下建立 iphoto2.0 頁面入口
  - 使用 shadcn/ui 元件建立現代化介面佈局
  - 實作響應式設計，支援桌面和行動裝置
  - 建立頁面導航和麵包屑功能
  - _Requirements: 4.1, 4.2, 4.5_

- [ ] 6.2 實作相簿瀏覽和管理介面
  - 建立專案相簿列表檢視，支援網格和列表模式
  - 實作相簿建立、編輯和刪除的互動介面
  - 建立相簿搜尋和篩選功能
  - 實作相簿標籤管理和批次操作介面
  - 整合 Oracle active_photo_albums 檢視表提升查詢效能
  - _Requirements: 4.3, 1.1, 1.4_

- [ ] 6.3 實作照片上傳和瀏覽介面
  - 建立拖拽式照片上傳元件，支援多檔案選擇
  - 實作上傳進度指示器和即時狀態回饋
  - 建立照片預覽和大圖檢視功能
  - 實作照片編輯介面，支援重新命名和標籤管理
  - 建立批次上傳介面，顯示處理進度和結果摘要
  - _Requirements: 4.4, 4.6, 2.1, 2.4_

- [ ] 7. 完善 API 層設計和 Oracle 整合
- [ ] 7.1 實作相簿管理 Oracle API 端點
  - 建立 /api/projects/[projectId]/albums RESTful 端點
  - 實作 /api/albums/[albumId] CRUD 操作端點
  - 整合現有 OracleConnectionWrapper 和錯誤處理機制
  - 實作 API 參數驗證和 Oracle 特定的安全性檢查
  - 利用 Oracle 倉儲工廠模式管理資料庫連線
  - _Requirements: 5.1, 5.2, 5.3, 5.5, 5.6_

- [ ] 7.2 實作照片管理 Oracle API 端點
  - 擴展現有 /api/photos 端點，支援相簿特定操作
  - 實作 /api/albums/[albumId]/photos 批次上傳端點
  - 建立分塊上傳專用 API 端點和 Oracle 狀態管理
  - 實作照片 metadata 更新和查詢 API，使用 Oracle JSON 功能
  - 整合現有 Oracle 監控和效能追蹤機制
  - _Requirements: 5.4, 5.5, 5.6_

- [ ] 7.3 實作檔案存取和下載 API
  - 建立安全的檔案存取 API，支援 Oracle 權限驗證
  - 實作照片預覽和縮圖生成端點
  - 建立照片下載功能，支援單一和批次下載
  - 實作檔案串流傳輸，優化大檔案存取效能
  - _Requirements: 3.5_

- [ ] 8. 實作 Oracle 照片 Metadata 管理系統
- [ ] 8.1 建立 EXIF 資料提取和 Oracle 儲存功能
  - 實作照片 EXIF 資料自動提取功能
  - 建立 GPS 位置、拍攝時間和相機資訊的 Oracle JSON 格式儲存
  - 實作 metadata 資料驗證和清理機制，利用 Oracle 約束檢查
  - 建立 metadata 更新失敗的恢復和 Oracle 日誌功能
  - 利用 Oracle CLOB 欄位儲存大容量 metadata 資料
  - _Requirements: 6.1, 6.2, 6.6_

- [ ] 8.2 實作照片搜尋和篩選系統
  - 建立多條件搜尋功能，支援日期、標籤、上傳者篩選
  - 實作檔案類型和大小範圍的篩選功能，使用 Oracle 索引優化查詢
  - 建立進階搜尋介面，支援 Oracle JSON metadata 欄位查詢
  - 實作搜尋結果排序和分頁功能，利用 Oracle 分頁查詢最佳化
  - 整合 Oracle 全文搜尋功能提升搜尋體驗
  - _Requirements: 6.4_

- [ ] 8.3 實作 Metadata 匯出和報告功能
  - 建立照片 metadata 的批次匯出功能
  - 實作多種匯出格式支援（CSV、JSON、Excel），使用 Oracle 查詢優化
  - 建立 metadata 統計報告和分析功能，利用 Oracle 檢視表 photo_statistics
  - 實作自訂 metadata 欄位管理功能，使用 Oracle JSON 靈活儲存
  - _Requirements: 6.3, 6.5_

- [ ] 9. 實作全面測試覆蓋系統
- [ ] 9.1 建立後端服務單元測試
  - 實作本地檔案儲存服務的完整單元測試
  - 建立 Oracle 相簿倉儲的業務邏輯測試，使用 Oracle 測試設定
  - 實作分塊上傳功能的核心邏輯測試
  - 建立批次處理系統的 worker 功能測試
  - 實作 API 控制器的請求處理測試，模擬 Oracle 連線
  - _Requirements: 8.1_

- [ ] 9.2 建立 Oracle 系統整合測試
  - 實作前後端照片上傳流程的整合測試，使用真實 Oracle 資料庫
  - 建立相簿 CRUD 操作的端到端整合測試
  - 實作檔案系統與 Oracle 資料庫同步的一致性測試
  - 建立分塊上傳和批次處理的 Oracle 整合測試
  - 利用現有 Oracle 測試容器和測試設定環境
  - _Requirements: 8.2_

- [ ] 9.3 實作效能和壓力測試
  - 建立大檔案上傳的效能基準測試
  - 實作並行批次處理的負載測試
  - 建立記憶體使用和資源洩漏的監控測試
  - 實作 Oracle 連線池和查詢效能的穩定性測試
  - 整合現有 Oracle 效能監控工具進行基準測試
  - _Requirements: 8.4_

- [ ] 10. 實作 Playwright 端到端測試和系統驗證
- [ ] 10.1 建立完整使用者流程測試
  - 實作專案相簿建立到照片上傳的完整流程測試
  - 建立多使用者同時操作的並行測試場景
  - 實作照片管理功能的端到端驗證測試
  - 建立錯誤情境和恢復機制的測試用例
  - 整合 Oracle 資料庫狀態驗證確保資料一致性
  - _Requirements: 8.3, 8.5_

- [ ] 10.2 實作系統整合驗證
  - 建立所有 API 端點的功能完整性驗證
  - 實作 Oracle 資料一致性和檔案同步的驗證測試
  - 建立跨瀏覽器和裝置的相容性測試
  - 實作系統效能指標和穩定性驗證
  - 建立測試報告生成和錯誤定位功能
  - _Requirements: 8.6_

- [ ] 10.3 實作生產就緒驗證
  - 建立功能完整性檢查清單和驗證程序
  - 實作安全性掃描和漏洞檢測驗證
  - 建立部署前的 Oracle 系統健康檢查功能
  - 實作使用者接受度測試和回饋收集機制
  - 驗證 Oracle 資料庫備份和災難恢復流程
  - _Requirements: 全部需求的最終驗證_